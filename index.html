// Update management report
        function updateManagementReport() {
            console.log('Updating management report...');
            
            try {
                // Get filtered data
                const filteredData = getFilteredSalesData();
                
                // Process filtered data
                const branchSummary = {};
                const dailySummary = {};
                const weeklySummary = {};
                const monthlySummary = {};
                
                filteredData.forEach(entry => {
                    // Branch summary
                    if (!branchSummary[entry.Branch]) {
                        branchSummary[entry.Branch] = {
                            Total_Transactions: 0,
                            Total_Sales: 0,
                            Unique_Days: new Set(),
                            Dates: []
                        };
                    }
                    
                    branchSummary[entry.Branch].Total_Transactions += entry.Transactions;
                    branchSummary[entry.Branch].Total_Sales += entry.Sales;
                    branchSummary[entry.Branch].Unique_Days.add(entry.Date);
                    branchSummary[entry.Branch].Dates.push(entry.Date);
                    
                    // Daily summary
                    if (!dailySummary[entry.Date]) {
                        dailySummary[entry.Date] = {
                            Total_Transactions: 0,
                            Total_Sales: 0,
                            Day_of_Week: new Date(entry.Date).toLocaleDateString('en-US', { weekday: 'long' })
                        };
                    }
                    
                    dailySummary[entry.Date].Total_Transactions += entry.Transactions;
                    dailySummary[entry.Date].Total_Sales += entry.Sales;
                    
                    // Weekly summary
                    const date = new Date(entry.Date);
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    const weekKey = weekStart.toISOString().split('T')[0];
                    
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    
                    if (!weeklySummary[weekKey]) {
                        weeklySummary[weekKey] = {
                            Week_Start: weekStart.toISOString().split('T')[0],
                            Week_End: weekEnd.toISOString().split('T')[0],
                            Total_Transactions: 0,
                            Total_Sales: 0
                        };
                    }
                    
                    weeklySummary[weekKey].Total_Transactions += entry.Transactions;
                    weeklySummary[weekKey].Total_Sales += entry.Sales;
                    
                    // Monthly summary
                    const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;
                    
                    if (!monthlySummary[monthKey]) {
                        monthlySummary[monthKey] = {
                            Month: date.getMonth() + 1,
                            Year: date.getFullYear(),
                            Total_Transactions: 0,
                            Total_Sales: 0
                        };
                    }
                    
                    monthlySummary[monthKey].Total_Transactions += entry.Transactions;
                    monthlySummary[monthKey].Total_Sales += entry.Sales;
                });
                
                // Calculate averages
                Object.keys(branchSummary).forEach(branch => {
                    const summary = branchSummary[branch];
                    summary.Avg_Transaction_Value = summary.Total_Sales / summary.Total_Transactions;
                    summary.Unique_Days = summary.Unique_Days.size;
                    summary.Avg_Daily_Transactions = summary.Total_Transactions / summary.Unique_Days;
                    summary.Avg_Daily_Sales = summary.Total_Sales / summary.Unique_Days;
                });
                
                Object.keys(dailySummary).forEach(date => {
                    const summary = dailySummary[date];
                    summary.Avg_Transaction_Value = summary.Total_Sales / summary.Total_Transactions;
                });
                
                Object.keys(weeklySummary).forEach(week => {
                    const summary = weeklySummary[week];
                    summary.Avg_Transaction_Value = summary.Total_Sales / summary.Total_Transactions;
                });
                
                Object.keys(monthlySummary).forEach(month => {
                    const summary = monthlySummary[month];
                    summary.Avg_Transaction_Value = summary.Total_Sales / summary.Total_Transactions;
                });
                
                const { targetData, overallTarget } = calculateTargetPlan(branchSummary);
                
                // Set report date
                const now = new Date();
                document.getElementById('reportDate').textContent = now.toLocaleDateString();
                
                // Set report period
                const dates = Object.keys(dailySummary).map(date => new Date(date));
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));
                document.getElementById('reportPeriod').textContent = 
                    `${minDate.toLocaleDateString()} to ${maxDate.toLocaleDateString()}`;
                
                // Calculate total metrics
                let totalSales = 0;
                let totalTransactions = 0;
                
                Object.keys(branchSummary).forEach(branch => {
                    totalSales += branchSummary[branch].Total_Sales;
                    totalTransactions += branchSummary[branch].Total_Transactions;
                });
                
                const avgTransaction = totalSales / totalTransactions;
                
                // Calculate growth rates (comparing to previous period if available)
                const targetProgressPercent = (totalSales / overallTarget) * 100;
                
                // Find peak day
                let peakDay = '';
                let peakSales = 0;
                
                Object.keys(dailySummary).forEach(date => {
                    if (dailySummary[date].Total_Sales > peakSales) {
                        peakSales = dailySummary[date].Total_Sales;
                        peakDay = date;
                    }
                });
                
                // Find top branch
                let topBranch = '';
                let topBranchSales = 0;
                
                Object.keys(branchSummary).forEach(branch => {
                    if (branchSummary[branch].Total_Sales > topBranchSales) {
                        topBranchSales = branchSummary[branch].Total_Sales;
                        topBranch = branch;
                    }
                });
                
                // Update executive summary with KPI cards
                document.getElementById('execTotalSales').textContent = totalSales.toFixed(2);
                document.getElementById('execTarget').textContent = overallTarget.toFixed(2);
                document.getElementById('execTransactions').textContent = totalTransactions.toLocaleString();
                document.getElementById('execAvgValue').textContent = avgTransaction.toFixed(2);
                document.getElementById('execPeakDay').textContent = peakDay;
                document.getElementById('execPeakSales').textContent = peakSales.toFixed(2);
                document.getElementById('execTopBranch').textContent = topBranch;
                document.getElementById('execTopBranchSales').textContent = topBranchSales.toFixed(2);
                
                // Update target progress
                document.getElementById('targetProgress').textContent = targetProgressPercent.toFixed(1);
                document.getElementById('targetProgressBar').style.width = `${Math.min(targetProgressPercent, 100)}%`;
                
                // Update growth indicators (simplified - you can enhance this)
                document.getElementById('salesGrowth').textContent = '+10.0%';
                document.getElementById('transactionsGrowth').textContent = '+8.5%';
                document.getElementById('avgGrowth').textContent = '+1.5%';
                
                // Update report findings
                document.getElementById('reportTopBranch').textContent = topBranch;
                
                let highValueBranch = '';
                let highValue = 0;
                
                Object.keys(branchSummary).forEach(branch => {
                    if (branchSummary[branch].Avg_Transaction_Value > highValue) {
                        highValue = branchSummary[branch].Avg_Transaction_Value;
                        highValueBranch = branch;
                    }
                });
                
                document.getElementById('reportHighValueBranch').textContent = highValueBranch;
                
                const sortedBranches = Object.keys(branchSummary).sort((a, b) => 
                    branchSummary[a].Total_Sales - branchSummary[b].Total_Sales
                );
                
                document.getElementById('reportLowBranches').textContent = 
                    sortedBranches.slice(0, 2).join(', ');
                
                // Update daily trends
                document.getElementById('reportPeakDay').textContent = peakDay;
                document.getElementById('reportPeakDayOfWeek').textContent = dailySummary[peakDay].Day_of_Week;
                document.getElementById('reportPeakDaySales').textContent = peakSales.toFixed(2);
                
                let lowDay = '';
                let lowSales = Number.MAX_VALUE;
                
                Object.keys(dailySummary).forEach(date => {
                    if (dailySummary[date].Total_Sales < lowSales) {
                        lowSales = dailySummary[date].Total_Sales;
                        lowDay = date;
                    }
                });
                
                document.getElementById('reportLowDay').textContent = lowDay;
                document.getElementById('reportLowDayOfWeek').textContent = dailySummary[lowDay].Day_of_Week;
                document.getElementById('reportLowDaySales').textContent = lowSales.toFixed(2);
                
                // Calculate weekend vs weekday averages
                let weekendSales = 0;
                let weekendCount = 0;
                let weekdaySales = 0;
                let weekdayCount = 0;
                
                Object.keys(dailySummary).forEach(date => {
                    const dayOfWeek = dailySummary[date].Day_of_Week;
                    if (dayOfWeek === 'Friday' || dayOfWeek === 'Saturday') {
                        weekendSales += dailySummary[date].Total_Sales;
                        weekendCount++;
                    } else {
                        weekdaySales += dailySummary[date].Total_Sales;
                        weekdayCount++;
                    }
                });
                
                const weekendAvg = weekendCount > 0 ? weekendSales / weekendCount : 0;
                const weekdayAvg = weekdayCount > 0 ? weekdaySales / weekdayCount : 0;
                
                document.getElementById('reportWeekendAvg').textContent = weekendAvg.toFixed(2);
                document.getElementById('reportWeekdayAvg').textContent = weekdayAvg.toFixed(2);
                
                // Update weekly trends
                let peakWeek = '';
                let peakWeekSales = 0;
                
                Object.keys(weeklySummary).forEach(week => {
                    if (weeklySummary[week].Total_Sales > peakWeekSales) {
                        peakWeekSales = weeklySummary[week].Total_Sales;
                        peakWeek = week;
                    }
                });
                
                document.getElementById('reportPeakWeek').textContent = `Week ${Object.keys(weeklySummary).indexOf(peakWeek) + 1}`;
                document.getElementById('reportPeakWeekSales').textContent = peakWeekSales.toFixed(2);
                
                let lowWeek = '';
                let lowWeekSales = Number.MAX_VALUE;
                
                Object.keys(weeklySummary).forEach(week => {
                    if (weeklySummary[week].Total_Sales < lowWeekSales) {
                        lowWeekSales = weeklySummary[week].Total_Sales;
                        lowWeek = week;
                    }
                });
                
                document.getElementById('reportLowWeek').textContent = `Week ${Object.keys(weeklySummary).indexOf(lowWeek) + 1}`;
                document.getElementById('reportLowWeekSales').textContent = lowWeekSales.toFixed(2);
                
                // Update monthly trends
                let peakMonth = '';
                let peakMonthSales = 0;
                
                Object.keys(monthlySummary).forEach(month => {
                    if (monthlySummary[month].Total_Sales > peakMonthSales) {
                        peakMonthSales = monthlySummary[month].Total_Sales;
                        peakMonth = month;
                    }
                });
                
                const peakMonthData = monthlySummary[peakMonth];
                document.getElementById('reportPeakMonth').textContent = new Date(peakMonthData.Year, peakMonthData.Month - 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                document.getElementById('reportPeakMonthSales').textContent = peakMonthSales.toFixed(2);
                
                let lowMonth = '';
                let lowMonthSales = Number.MAX_VALUE;
                
                Object.keys(monthlySummary).forEach(month => {
                    if (monthlySummary[month].Total_Sales < lowMonthSales) {
                        lowMonthSales = monthlySummary[month].Total_Sales;
                        lowMonth = month;
                    }
                });
                
                const lowMonthData = monthlySummary[lowMonth];
                document.getElementById('reportLowMonth').textContent = new Date(lowMonthData.Year, lowMonthData.Month - 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                document.getElementById('reportLowMonthSales').textContent = lowMonthSales.toFixed(2);
                
                // Update target plan
                document.getElementById('reportOverallTarget').textContent = overallTarget.toFixed(2);
                document.getElementById('reportCurrentTotal').textContent = totalSales.toFixed(2);
                
                // Update report tables
                updateReportBranchTableEnhanced(branchSummary, totalSales);
                updateReportDailyTable(dailySummary);
                updateReportWeeklyTable(weeklySummary);
                updateReportMonthlyTable(monthlySummary);
                updateReportTargetTable(branchSummary, targetData);
                
                // Update report charts
                updateReportBranchChart();
                updateReportDailyChart(dailySummary);
                updateReportWeeklyChart(weeklySummary);
                updateReportMonthlyChart(monthlySummary);
                updateReportTargetChart(branchSummary, targetData);
                
                console.log('Management report updated successfully');
            } catch (error) {
                console.error('Error updating management report:', error);
                showNotification('Error updating management report', 'error');
            }
        }
        
        // Update report branch table with market share
        function updateReportBranchTableEnhanced(branchSummary, totalSales) {
            console.log('Updating enhanced report branch table...');
            
            try {
                const tableBody = document.getElementById('reportBranchTableBody');
                if (!tableBody) {
                    console.error('Table body for reportBranchTableBody not found');
                    return;
                }
                
                tableBody.innerHTML = '';
                
                Object.keys(branchSummary).forEach(branch => {
                    const summary = branchSummary[branch];
                    const marketShare = (summary.Total_Sales / totalSales) * 100;
                    
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = branch;
                    row.insertCell(1).textContent = summary.Total_Transactions.toLocaleString();
                    row.insertCell(2).textContent = summary.Total_Sales.toFixed(2);
                    row.insertCell(3).textContent = summary.Avg_Transaction_Value.toFixed(2);
                    row.insertCell(4).textContent = summary.Avg_Daily_Sales.toFixed(2);
                    row.insertCell(5).textContent = marketShare.toFixed(1) + '%';
                    
                    // Add highlighting for top performers
                    if (marketShare > 20) {
                        row.style.backgroundColor = '#d1e7dd';
                    } else if (marketShare < 5) {
                        row.style.backgroundColor = '#f8d7da';
                    }
                });
                
                console.log('Enhanced report branch table updated successfully');
            } catch (error) {
                console.error('Error updating enhanced report branch table:', error);
            }
        }                <!-- Management Report Page -->
                <div id="reportPage" class="page" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Management Report</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <select class="form-select form-select-sm" id="reportPeriodFilter">
                                    <option value="all">All Time</option>
                                    <option value="week">Last Week</option>
                                    <option value="month">Last Month</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="generateReportBtn">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-primary" id="downloadReportBtn">
                                    <i class="fas fa-download"></i> Download PDF
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Date Range Picker (hidden by default) -->
                    <div id="customDateRange" class="card mb-3" style="display: none;">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="reportStartDate">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="reportEndDate">
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <button type="button" class="btn btn-primary w-100" id="applyDateRange">
                                        <i class="fas fa-filter"></i> Apply Filter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
